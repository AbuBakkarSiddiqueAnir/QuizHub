{"/Users/mac/work/package/mongoose-serial/src/index.ts":{"path":"/Users/mac/work/package/mongoose-serial/src/index.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":18},"end":{"line":37,"column":1}},"13":{"start":{"line":12,"column":12},"end":{"line":12,"column":104}},"14":{"start":{"line":12,"column":43},"end":{"line":12,"column":68}},"15":{"start":{"line":12,"column":57},"end":{"line":12,"column":68}},"16":{"start":{"line":12,"column":69},"end":{"line":12,"column":81}},"17":{"start":{"line":13,"column":4},"end":{"line":13,"column":157}},"18":{"start":{"line":13,"column":138},"end":{"line":13,"column":150}},"19":{"start":{"line":14,"column":23},"end":{"line":14,"column":68}},"20":{"start":{"line":14,"column":45},"end":{"line":14,"column":65}},"21":{"start":{"line":16,"column":8},"end":{"line":16,"column":70}},"22":{"start":{"line":16,"column":15},"end":{"line":16,"column":70}},"23":{"start":{"line":17,"column":8},"end":{"line":34,"column":66}},"24":{"start":{"line":17,"column":18},"end":{"line":34,"column":66}},"25":{"start":{"line":18,"column":12},"end":{"line":18,"column":169}},"26":{"start":{"line":18,"column":160},"end":{"line":18,"column":169}},"27":{"start":{"line":19,"column":12},"end":{"line":19,"column":52}},"28":{"start":{"line":19,"column":26},"end":{"line":19,"column":52}},"29":{"start":{"line":20,"column":12},"end":{"line":32,"column":13}},"30":{"start":{"line":21,"column":32},"end":{"line":21,"column":39}},"31":{"start":{"line":21,"column":40},"end":{"line":21,"column":46}},"32":{"start":{"line":22,"column":24},"end":{"line":22,"column":34}},"33":{"start":{"line":22,"column":35},"end":{"line":22,"column":72}},"34":{"start":{"line":23,"column":24},"end":{"line":23,"column":34}},"35":{"start":{"line":23,"column":35},"end":{"line":23,"column":45}},"36":{"start":{"line":23,"column":46},"end":{"line":23,"column":55}},"37":{"start":{"line":23,"column":56},"end":{"line":23,"column":65}},"38":{"start":{"line":24,"column":24},"end":{"line":24,"column":41}},"39":{"start":{"line":24,"column":42},"end":{"line":24,"column":55}},"40":{"start":{"line":24,"column":56},"end":{"line":24,"column":65}},"41":{"start":{"line":26,"column":20},"end":{"line":26,"column":128}},"42":{"start":{"line":26,"column":110},"end":{"line":26,"column":116}},"43":{"start":{"line":26,"column":117},"end":{"line":26,"column":126}},"44":{"start":{"line":27,"column":20},"end":{"line":27,"column":106}},"45":{"start":{"line":27,"column":81},"end":{"line":27,"column":97}},"46":{"start":{"line":27,"column":98},"end":{"line":27,"column":104}},"47":{"start":{"line":28,"column":20},"end":{"line":28,"column":89}},"48":{"start":{"line":28,"column":57},"end":{"line":28,"column":72}},"49":{"start":{"line":28,"column":73},"end":{"line":28,"column":80}},"50":{"start":{"line":28,"column":81},"end":{"line":28,"column":87}},"51":{"start":{"line":29,"column":20},"end":{"line":29,"column":87}},"52":{"start":{"line":29,"column":47},"end":{"line":29,"column":62}},"53":{"start":{"line":29,"column":63},"end":{"line":29,"column":78}},"54":{"start":{"line":29,"column":79},"end":{"line":29,"column":85}},"55":{"start":{"line":30,"column":20},"end":{"line":30,"column":42}},"56":{"start":{"line":30,"column":30},"end":{"line":30,"column":42}},"57":{"start":{"line":31,"column":20},"end":{"line":31,"column":33}},"58":{"start":{"line":31,"column":34},"end":{"line":31,"column":43}},"59":{"start":{"line":33,"column":12},"end":{"line":33,"column":39}},"60":{"start":{"line":34,"column":22},"end":{"line":34,"column":34}},"61":{"start":{"line":34,"column":35},"end":{"line":34,"column":41}},"62":{"start":{"line":34,"column":54},"end":{"line":34,"column":64}},"63":{"start":{"line":35,"column":8},"end":{"line":35,"column":35}},"64":{"start":{"line":35,"column":23},"end":{"line":35,"column":35}},"65":{"start":{"line":35,"column":36},"end":{"line":35,"column":89}},"66":{"start":{"line":38,"column":0},"end":{"line":38,"column":62}},"67":{"start":{"line":39,"column":0},"end":{"line":39,"column":90}},"68":{"start":{"line":40,"column":15},"end":{"line":40,"column":34}},"69":{"start":{"line":45,"column":0},"end":{"line":50,"column":68}},"70":{"start":{"line":46,"column":4},"end":{"line":46,"column":37}},"71":{"start":{"line":47,"column":4},"end":{"line":47,"column":39}},"72":{"start":{"line":48,"column":4},"end":{"line":48,"column":35}},"73":{"start":{"line":49,"column":4},"end":{"line":49,"column":37}},"74":{"start":{"line":56,"column":15},"end":{"line":61,"column":1}},"75":{"start":{"line":57,"column":24},"end":{"line":57,"column":42}},"76":{"start":{"line":58,"column":4},"end":{"line":59,"column":44}},"77":{"start":{"line":59,"column":8},"end":{"line":59,"column":44}},"78":{"start":{"line":60,"column":4},"end":{"line":60,"column":25}},"79":{"start":{"line":62,"column":0},"end":{"line":62,"column":28}},"80":{"start":{"line":68,"column":21},"end":{"line":98,"column":1}},"81":{"start":{"line":69,"column":20},"end":{"line":69,"column":37}},"82":{"start":{"line":69,"column":53},"end":{"line":69,"column":72}},"83":{"start":{"line":69,"column":79},"end":{"line":69,"column":93}},"84":{"start":{"line":69,"column":104},"end":{"line":69,"column":127}},"85":{"start":{"line":71,"column":4},"end":{"line":97,"column":43}},"86":{"start":{"line":72,"column":8},"end":{"line":72,"column":68}},"87":{"start":{"line":73,"column":21},"end":{"line":73,"column":44}},"88":{"start":{"line":74,"column":8},"end":{"line":93,"column":9}},"89":{"start":{"line":76,"column":34},"end":{"line":76,"column":69}},"90":{"start":{"line":77,"column":27},"end":{"line":77,"column":52}},"91":{"start":{"line":78,"column":16},"end":{"line":79,"column":55}},"92":{"start":{"line":79,"column":20},"end":{"line":79,"column":55}},"93":{"start":{"line":80,"column":16},"end":{"line":80,"column":22}},"94":{"start":{"line":82,"column":35},"end":{"line":82,"column":81}},"95":{"start":{"line":83,"column":28},"end":{"line":83,"column":53}},"96":{"start":{"line":84,"column":16},"end":{"line":85,"column":55}},"97":{"start":{"line":85,"column":20},"end":{"line":85,"column":55}},"98":{"start":{"line":86,"column":16},"end":{"line":86,"column":22}},"99":{"start":{"line":88,"column":33},"end":{"line":88,"column":74}},"100":{"start":{"line":89,"column":26},"end":{"line":89,"column":51}},"101":{"start":{"line":90,"column":16},"end":{"line":91,"column":55}},"102":{"start":{"line":91,"column":20},"end":{"line":91,"column":55}},"103":{"start":{"line":92,"column":16},"end":{"line":92,"column":22}},"104":{"start":{"line":94,"column":8},"end":{"line":94,"column":63}},"105":{"start":{"line":97,"column":8},"end":{"line":97,"column":43}},"106":{"start":{"line":99,"column":0},"end":{"line":99,"column":40}},"107":{"start":{"line":105,"column":13},"end":{"line":157,"column":1}},"108":{"start":{"line":106,"column":16},"end":{"line":106,"column":29}},"109":{"start":{"line":106,"column":40},"end":{"line":106,"column":54}},"110":{"start":{"line":106,"column":68},"end":{"line":106,"column":85}},"111":{"start":{"line":106,"column":101},"end":{"line":106,"column":120}},"112":{"start":{"line":108,"column":4},"end":{"line":156,"column":7}},"113":{"start":{"line":109,"column":8},"end":{"line":155,"column":11}},"114":{"start":{"line":112,"column":12},"end":{"line":154,"column":15}},"115":{"start":{"line":113,"column":16},"end":{"line":153,"column":17}},"116":{"start":{"line":115,"column":24},"end":{"line":115,"column":35}},"117":{"start":{"line":117,"column":24},"end":{"line":119,"column":25}},"118":{"start":{"line":118,"column":28},"end":{"line":118,"column":72}},"119":{"start":{"line":120,"column":24},"end":{"line":120,"column":37}},"120":{"start":{"line":122,"column":24},"end":{"line":122,"column":50}},"121":{"start":{"line":123,"column":24},"end":{"line":123,"column":116}},"122":{"start":{"line":125,"column":24},"end":{"line":125,"column":44}},"123":{"start":{"line":126,"column":24},"end":{"line":126,"column":48}},"124":{"start":{"line":128,"column":24},"end":{"line":128,"column":44}},"125":{"start":{"line":129,"column":24},"end":{"line":129,"column":38}},"126":{"start":{"line":131,"column":24},"end":{"line":131,"column":65}},"127":{"start":{"line":132,"column":24},"end":{"line":132,"column":74}},"128":{"start":{"line":133,"column":24},"end":{"line":143,"column":25}},"129":{"start":{"line":135,"column":32},"end":{"line":135,"column":77}},"130":{"start":{"line":136,"column":32},"end":{"line":136,"column":38}},"131":{"start":{"line":138,"column":32},"end":{"line":138,"column":143}},"132":{"start":{"line":139,"column":32},"end":{"line":139,"column":38}},"133":{"start":{"line":141,"column":32},"end":{"line":141,"column":186}},"134":{"start":{"line":142,"column":32},"end":{"line":142,"column":38}},"135":{"start":{"line":144,"column":24},"end":{"line":144,"column":31}},"136":{"start":{"line":145,"column":24},"end":{"line":146,"column":43}},"137":{"start":{"line":146,"column":28},"end":{"line":146,"column":43}},"138":{"start":{"line":147,"column":24},"end":{"line":148,"column":43}},"139":{"start":{"line":148,"column":28},"end":{"line":148,"column":43}},"140":{"start":{"line":149,"column":24},"end":{"line":149,"column":40}},"141":{"start":{"line":150,"column":24},"end":{"line":150,"column":55}},"142":{"start":{"line":151,"column":24},"end":{"line":151,"column":31}},"143":{"start":{"line":152,"column":24},"end":{"line":152,"column":46}},"144":{"start":{"line":158,"column":0},"end":{"line":158,"column":24}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"(anonymous_7)","decl":{"start":{"line":11,"column":48},"end":{"line":11,"column":49}},"loc":{"start":{"line":11,"column":73},"end":{"line":37,"column":1}},"line":11},"8":{"name":"(anonymous_8)","decl":{"start":{"line":12,"column":30},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":41},"end":{"line":12,"column":83}},"line":12},"9":{"name":"(anonymous_9)","decl":{"start":{"line":13,"column":125},"end":{"line":13,"column":126}},"loc":{"start":{"line":13,"column":136},"end":{"line":13,"column":152}},"line":13},"10":{"name":"verb","decl":{"start":{"line":14,"column":13},"end":{"line":14,"column":17}},"loc":{"start":{"line":14,"column":21},"end":{"line":14,"column":70}},"line":14},"11":{"name":"(anonymous_11)","decl":{"start":{"line":14,"column":30},"end":{"line":14,"column":31}},"loc":{"start":{"line":14,"column":43},"end":{"line":14,"column":67}},"line":14},"12":{"name":"step","decl":{"start":{"line":15,"column":13},"end":{"line":15,"column":17}},"loc":{"start":{"line":15,"column":22},"end":{"line":36,"column":5}},"line":15},"13":{"name":"(anonymous_13)","decl":{"start":{"line":45,"column":1},"end":{"line":45,"column":2}},"loc":{"start":{"line":45,"column":24},"end":{"line":50,"column":1}},"line":45},"14":{"name":"(anonymous_14)","decl":{"start":{"line":56,"column":15},"end":{"line":56,"column":16}},"loc":{"start":{"line":56,"column":40},"end":{"line":61,"column":1}},"line":56},"15":{"name":"(anonymous_15)","decl":{"start":{"line":68,"column":21},"end":{"line":68,"column":22}},"loc":{"start":{"line":68,"column":48},"end":{"line":98,"column":1}},"line":68},"16":{"name":"(anonymous_16)","decl":{"start":{"line":105,"column":13},"end":{"line":105,"column":14}},"loc":{"start":{"line":105,"column":40},"end":{"line":157,"column":1}},"line":105},"17":{"name":"(anonymous_17)","decl":{"start":{"line":108,"column":23},"end":{"line":108,"column":24}},"loc":{"start":{"line":108,"column":39},"end":{"line":156,"column":5}},"line":108},"18":{"name":"(anonymous_18)","decl":{"start":{"line":109,"column":47},"end":{"line":109,"column":48}},"loc":{"start":{"line":109,"column":59},"end":{"line":155,"column":9}},"line":109},"19":{"name":"(anonymous_19)","decl":{"start":{"line":112,"column":37},"end":{"line":112,"column":38}},"loc":{"start":{"line":112,"column":51},"end":{"line":154,"column":13}},"line":112}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8},"5":{"loc":{"start":{"line":11,"column":18},"end":{"line":37,"column":1}},"type":"binary-expr","locations":[{"start":{"line":11,"column":19},"end":{"line":11,"column":23}},{"start":{"line":11,"column":27},"end":{"line":11,"column":43}},{"start":{"line":11,"column":48},"end":{"line":37,"column":1}}],"line":11},"6":{"loc":{"start":{"line":12,"column":43},"end":{"line":12,"column":68}},"type":"if","locations":[{"start":{"line":12,"column":43},"end":{"line":12,"column":68}},{"start":{"line":12,"column":43},"end":{"line":12,"column":68}}],"line":12},"7":{"loc":{"start":{"line":13,"column":71},"end":{"line":13,"column":153}},"type":"binary-expr","locations":[{"start":{"line":13,"column":71},"end":{"line":13,"column":99}},{"start":{"line":13,"column":104},"end":{"line":13,"column":152}}],"line":13},"8":{"loc":{"start":{"line":16,"column":8},"end":{"line":16,"column":70}},"type":"if","locations":[{"start":{"line":16,"column":8},"end":{"line":16,"column":70}},{"start":{"line":16,"column":8},"end":{"line":16,"column":70}}],"line":16},"9":{"loc":{"start":{"line":18,"column":12},"end":{"line":18,"column":169}},"type":"if","locations":[{"start":{"line":18,"column":12},"end":{"line":18,"column":169}},{"start":{"line":18,"column":12},"end":{"line":18,"column":169}}],"line":18},"10":{"loc":{"start":{"line":18,"column":23},"end":{"line":18,"column":158}},"type":"binary-expr","locations":[{"start":{"line":18,"column":23},"end":{"line":18,"column":24}},{"start":{"line":18,"column":29},"end":{"line":18,"column":125}},{"start":{"line":18,"column":130},"end":{"line":18,"column":158}}],"line":18},"11":{"loc":{"start":{"line":18,"column":33},"end":{"line":18,"column":125}},"type":"cond-expr","locations":[{"start":{"line":18,"column":45},"end":{"line":18,"column":56}},{"start":{"line":18,"column":59},"end":{"line":18,"column":125}}],"line":18},"12":{"loc":{"start":{"line":18,"column":59},"end":{"line":18,"column":125}},"type":"cond-expr","locations":[{"start":{"line":18,"column":67},"end":{"line":18,"column":116}},{"start":{"line":18,"column":119},"end":{"line":18,"column":125}}],"line":18},"13":{"loc":{"start":{"line":18,"column":67},"end":{"line":18,"column":116}},"type":"binary-expr","locations":[{"start":{"line":18,"column":67},"end":{"line":18,"column":77}},{"start":{"line":18,"column":82},"end":{"line":18,"column":115}}],"line":18},"14":{"loc":{"start":{"line":18,"column":82},"end":{"line":18,"column":112}},"type":"binary-expr","locations":[{"start":{"line":18,"column":83},"end":{"line":18,"column":98}},{"start":{"line":18,"column":103},"end":{"line":18,"column":112}}],"line":18},"15":{"loc":{"start":{"line":19,"column":12},"end":{"line":19,"column":52}},"type":"if","locations":[{"start":{"line":19,"column":12},"end":{"line":19,"column":52}},{"start":{"line":19,"column":12},"end":{"line":19,"column":52}}],"line":19},"16":{"loc":{"start":{"line":20,"column":12},"end":{"line":32,"column":13}},"type":"switch","locations":[{"start":{"line":21,"column":16},"end":{"line":21,"column":23}},{"start":{"line":21,"column":24},"end":{"line":21,"column":46}},{"start":{"line":22,"column":16},"end":{"line":22,"column":72}},{"start":{"line":23,"column":16},"end":{"line":23,"column":65}},{"start":{"line":24,"column":16},"end":{"line":24,"column":65}},{"start":{"line":25,"column":16},"end":{"line":31,"column":43}}],"line":20},"17":{"loc":{"start":{"line":26,"column":20},"end":{"line":26,"column":128}},"type":"if","locations":[{"start":{"line":26,"column":20},"end":{"line":26,"column":128}},{"start":{"line":26,"column":20},"end":{"line":26,"column":128}}],"line":26},"18":{"loc":{"start":{"line":26,"column":24},"end":{"line":26,"column":106}},"type":"binary-expr","locations":[{"start":{"line":26,"column":24},"end":{"line":26,"column":74}},{"start":{"line":26,"column":79},"end":{"line":26,"column":90}},{"start":{"line":26,"column":94},"end":{"line":26,"column":105}}],"line":26},"19":{"loc":{"start":{"line":26,"column":42},"end":{"line":26,"column":73}},"type":"binary-expr","locations":[{"start":{"line":26,"column":42},"end":{"line":26,"column":54}},{"start":{"line":26,"column":58},"end":{"line":26,"column":73}}],"line":26},"20":{"loc":{"start":{"line":27,"column":20},"end":{"line":27,"column":106}},"type":"if","locations":[{"start":{"line":27,"column":20},"end":{"line":27,"column":106}},{"start":{"line":27,"column":20},"end":{"line":27,"column":106}}],"line":27},"21":{"loc":{"start":{"line":27,"column":24},"end":{"line":27,"column":77}},"type":"binary-expr","locations":[{"start":{"line":27,"column":24},"end":{"line":27,"column":35}},{"start":{"line":27,"column":40},"end":{"line":27,"column":42}},{"start":{"line":27,"column":47},"end":{"line":27,"column":59}},{"start":{"line":27,"column":63},"end":{"line":27,"column":75}}],"line":27},"22":{"loc":{"start":{"line":28,"column":20},"end":{"line":28,"column":89}},"type":"if","locations":[{"start":{"line":28,"column":20},"end":{"line":28,"column":89}},{"start":{"line":28,"column":20},"end":{"line":28,"column":89}}],"line":28},"23":{"loc":{"start":{"line":28,"column":24},"end":{"line":28,"column":53}},"type":"binary-expr","locations":[{"start":{"line":28,"column":24},"end":{"line":28,"column":35}},{"start":{"line":28,"column":39},"end":{"line":28,"column":53}}],"line":28},"24":{"loc":{"start":{"line":29,"column":20},"end":{"line":29,"column":87}},"type":"if","locations":[{"start":{"line":29,"column":20},"end":{"line":29,"column":87}},{"start":{"line":29,"column":20},"end":{"line":29,"column":87}}],"line":29},"25":{"loc":{"start":{"line":29,"column":24},"end":{"line":29,"column":43}},"type":"binary-expr","locations":[{"start":{"line":29,"column":24},"end":{"line":29,"column":25}},{"start":{"line":29,"column":29},"end":{"line":29,"column":43}}],"line":29},"26":{"loc":{"start":{"line":30,"column":20},"end":{"line":30,"column":42}},"type":"if","locations":[{"start":{"line":30,"column":20},"end":{"line":30,"column":42}},{"start":{"line":30,"column":20},"end":{"line":30,"column":42}}],"line":30},"27":{"loc":{"start":{"line":35,"column":8},"end":{"line":35,"column":35}},"type":"if","locations":[{"start":{"line":35,"column":8},"end":{"line":35,"column":35}},{"start":{"line":35,"column":8},"end":{"line":35,"column":35}}],"line":35},"28":{"loc":{"start":{"line":35,"column":52},"end":{"line":35,"column":74}},"type":"cond-expr","locations":[{"start":{"line":35,"column":60},"end":{"line":35,"column":65}},{"start":{"line":35,"column":68},"end":{"line":35,"column":74}}],"line":35},"29":{"loc":{"start":{"line":50,"column":17},"end":{"line":50,"column":66}},"type":"binary-expr","locations":[{"start":{"line":50,"column":17},"end":{"line":50,"column":36}},{"start":{"line":50,"column":41},"end":{"line":50,"column":65}}],"line":50},"30":{"loc":{"start":{"line":69,"column":104},"end":{"line":69,"column":127}},"type":"cond-expr","locations":[{"start":{"line":69,"column":120},"end":{"line":69,"column":122}},{"start":{"line":69,"column":125},"end":{"line":69,"column":127}}],"line":69},"31":{"loc":{"start":{"line":71,"column":4},"end":{"line":97,"column":43}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":97,"column":43}},{"start":{"line":71,"column":4},"end":{"line":97,"column":43}}],"line":71},"32":{"loc":{"start":{"line":74,"column":8},"end":{"line":93,"column":9}},"type":"switch","locations":[{"start":{"line":75,"column":12},"end":{"line":80,"column":22}},{"start":{"line":81,"column":12},"end":{"line":86,"column":22}},{"start":{"line":87,"column":12},"end":{"line":92,"column":22}}],"line":74},"33":{"loc":{"start":{"line":78,"column":16},"end":{"line":79,"column":55}},"type":"if","locations":[{"start":{"line":78,"column":16},"end":{"line":79,"column":55}},{"start":{"line":78,"column":16},"end":{"line":79,"column":55}}],"line":78},"34":{"loc":{"start":{"line":84,"column":16},"end":{"line":85,"column":55}},"type":"if","locations":[{"start":{"line":84,"column":16},"end":{"line":85,"column":55}},{"start":{"line":84,"column":16},"end":{"line":85,"column":55}}],"line":84},"35":{"loc":{"start":{"line":90,"column":16},"end":{"line":91,"column":55}},"type":"if","locations":[{"start":{"line":90,"column":16},"end":{"line":91,"column":55}},{"start":{"line":90,"column":16},"end":{"line":91,"column":55}}],"line":90},"36":{"loc":{"start":{"line":113,"column":16},"end":{"line":153,"column":17}},"type":"switch","locations":[{"start":{"line":114,"column":20},"end":{"line":120,"column":37}},{"start":{"line":121,"column":20},"end":{"line":123,"column":116}},{"start":{"line":124,"column":20},"end":{"line":126,"column":48}},{"start":{"line":127,"column":20},"end":{"line":129,"column":38}},{"start":{"line":130,"column":20},"end":{"line":152,"column":46}}],"line":113},"37":{"loc":{"start":{"line":117,"column":24},"end":{"line":119,"column":25}},"type":"if","locations":[{"start":{"line":117,"column":24},"end":{"line":119,"column":25}},{"start":{"line":117,"column":24},"end":{"line":119,"column":25}}],"line":117},"38":{"loc":{"start":{"line":131,"column":33},"end":{"line":131,"column":64}},"type":"cond-expr","locations":[{"start":{"line":131,"column":43},"end":{"line":131,"column":57}},{"start":{"line":131,"column":60},"end":{"line":131,"column":64}}],"line":131},"39":{"loc":{"start":{"line":133,"column":24},"end":{"line":143,"column":25}},"type":"switch","locations":[{"start":{"line":134,"column":28},"end":{"line":136,"column":38}},{"start":{"line":137,"column":28},"end":{"line":139,"column":38}},{"start":{"line":140,"column":28},"end":{"line":142,"column":38}}],"line":133},"40":{"loc":{"start":{"line":145,"column":24},"end":{"line":146,"column":43}},"type":"if","locations":[{"start":{"line":145,"column":24},"end":{"line":146,"column":43}},{"start":{"line":145,"column":24},"end":{"line":146,"column":43}}],"line":145},"41":{"loc":{"start":{"line":147,"column":24},"end":{"line":148,"column":43}},"type":"if","locations":[{"start":{"line":147,"column":24},"end":{"line":148,"column":43}},{"start":{"line":147,"column":24},"end":{"line":148,"column":43}}],"line":147}},"s":{"0":1,"1":16,"2":16,"3":16,"4":16,"5":16,"6":0,"7":0,"8":0,"9":0,"10":32,"11":16,"12":1,"13":16,"14":16,"15":0,"16":16,"17":16,"18":0,"19":48,"20":32,"21":32,"22":0,"23":32,"24":96,"25":96,"26":0,"27":96,"28":0,"29":96,"30":32,"31":32,"32":16,"33":16,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":48,"42":16,"43":16,"44":32,"45":16,"46":16,"47":16,"48":0,"49":0,"50":0,"51":16,"52":0,"53":0,"54":0,"55":16,"56":0,"57":16,"58":16,"59":48,"60":0,"61":0,"62":96,"63":16,"64":0,"65":16,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":31,"76":31,"77":126,"78":31,"79":1,"80":1,"81":20,"82":20,"83":20,"84":20,"85":20,"86":16,"87":16,"88":16,"89":4,"90":4,"91":4,"92":0,"93":4,"94":4,"95":4,"96":4,"97":0,"98":4,"99":1,"100":1,"101":1,"102":1,"103":0,"104":15,"105":4,"106":1,"107":1,"108":4,"109":4,"110":4,"111":4,"112":4,"113":16,"114":16,"115":48,"116":16,"117":16,"118":0,"119":16,"120":16,"121":16,"122":16,"123":16,"124":0,"125":0,"126":16,"127":16,"128":16,"129":4,"130":4,"131":4,"132":4,"133":0,"134":0,"135":16,"136":16,"137":8,"138":16,"139":8,"140":16,"141":16,"142":16,"143":16,"144":1},"f":{"0":16,"1":16,"2":16,"3":16,"4":16,"5":0,"6":32,"7":16,"8":16,"9":0,"10":48,"11":32,"12":32,"13":1,"14":31,"15":20,"16":4,"17":16,"18":16,"19":48},"b":{"0":[1,1,1],"1":[0,16],"2":[16,16],"3":[16,16],"4":[16,16],"5":[1,1,1],"6":[0,16],"7":[16,16],"8":[0,32],"9":[0,96],"10":[96,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,96],"16":[32,32,16,0,0,48],"17":[16,32],"18":[48,32,32],"19":[48,16],"20":[16,16],"21":[32,32,16,16],"22":[0,16],"23":[16,0],"24":[0,16],"25":[16,16],"26":[0,16],"27":[0,16],"28":[16,0],"29":[1,1],"30":[1,19],"31":[16,4],"32":[4,4,1],"33":[0,4],"34":[0,4],"35":[1,0],"36":[16,16,16,0,16],"37":[0,16],"38":[12,4],"39":[4,4,0],"40":[8,8],"41":[8,8]},"inputSourceMap":{"version":3,"file":"/Users/mac/work/package/mongoose-serial/src/index.ts","sources":["/Users/mac/work/package/mongoose-serial/src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import * as mongoose from \"mongoose\"\nimport { Schema } from \"mongoose\"\n\n/**\n * \n */\nexport enum InitCounter {\n  YEARLY = \"yearly\",\n  MONTHLY = \"monthly\",\n  DAILY = \"daily\",\n  HOURLY = \"hourly\"\n}\n\n/**\n * \n */\nexport type Options = {\n  field: string,\n  prefix: string,\n  format: string,\n  separator: string,\n  initCounter: \"yearly\" | \"monthly\" | \"daily\" | \"hourly\"\n  digits: number\n}\n\n/**\n * \n * @param counter \n * @param size \n */\nexport const addZeros = (counter: number, size: number) => {\n  let counterString = counter.toString();\n  while (counterString.length < size) counterString = \"0\" + counterString;\n  return counterString;\n}\n\n/**\n * \n * @param options \n * @param serial \n */\nexport const extractCounter = (options: Options, serial: string): string => {\n  let { separator, initCounter, digits = 10 } = options\n  let counter: string\n\n  if (serial !== null) {\n    counter = serial.split(separator).slice(-1).join(separator)\n    let chunks = serial.split(separator)\n    switch (initCounter) {\n      case InitCounter.YEARLY:\n        let currentYear = new Date().getFullYear().toString()\n        let year = chunks[chunks.length - 2]\n        if (currentYear !== year)\n          return addZeros(1, digits)\n        break\n      case InitCounter.MONTHLY:\n        let currentMonth = addZeros(new Date().getMonth() + 1, 2)\n        let month = chunks[chunks.length - 2]\n        if (currentMonth !== month)\n          return addZeros(1, digits)\n        break\n      case InitCounter.DAILY:\n        let currentDay = addZeros(new Date().getDate(), 2)\n        let day = chunks[chunks.length - 2]\n        if (currentDay !== day)\n          return addZeros(1, digits)\n        break\n    }\n\n    return addZeros(parseInt(counter) + 1, digits)\n  } else\n    return addZeros(1, digits)\n}\n\n/**\n * \n * @param schema \n * @param options \n */\nexport const plugin = (schema: Schema, options: Options) => {\n  let { field, prefix, separator, initCounter } = options\n  let counter;\n  schema.pre(\"save\", async function (next) {\n    let doc: any = this\n    // feild must a string\n    if (!(schema.path(field) instanceof mongoose.Schema.Types.String)) {\n      next(Error(\"Field must be type of string\"))\n    }\n\n    // get the last inserted document\n    let lastDoc;\n    try {\n      lastDoc = await (<any>this).constructor.findOne({}).sort({ [`${field}`]: -1 })\n    } catch (error) {\n      throw error\n    }\n    let serial = lastDoc ? lastDoc[field] : null\n\n    counter = extractCounter(options, serial)\n\n    // retrive the last count\n    let dating;\n    switch (initCounter) {\n      case InitCounter.YEARLY:\n        dating = new Date().getFullYear().toString()\n        break\n      case InitCounter.MONTHLY:\n        dating = [new Date().getFullYear().toString(), addZeros(new Date().getMonth() + 1, 2)].join(separator)\n        break\n      case InitCounter.DAILY:\n        dating = [new Date().getFullYear().toString(), addZeros(new Date().getMonth() + 1, 2), addZeros(new Date().getDate(), 2)].join(separator)\n        break\n    }\n    let t = []\n    if (prefix) t.push(prefix)\n    if (dating) t.push(dating)\n    t.push(counter)\n    doc[field] = t.join(separator)\n    next()\n  })\n}\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4c50a335c659affe940a647fd38fbb1219eb0b7e","contentHash":"77b91e699d8b2a2497acde4b1d0e589f9422829b554c07ae193a361f17a6bdf2"}}